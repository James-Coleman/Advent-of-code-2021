//
//  Day 20.swift
//  Advent of Code 2021
//
//  Created by James Coleman on 20/12/2021.
//

import Foundation

func day20() {
    enum Error: Swift.Error {
        case couldNotCreateInt(from: String)
    }

    func nextImage(from input: String, algorithm: String, margin: Int = 0, currentGeneration: Int = 0) throws -> [[Character]] {
        
        let mapped = input.components(separatedBy: .newlines).map { $0.map { $0 == "." ? "0" : "1" } }
        
        guard let firstRow = mapped.first else { return [] }
        
        var arrayToReturn = [[Character]]()
        
        /// Will either be `0` if outside margins can be assumed to be `.` or `1` if outside margins can be assumed to be `#`
        let assumptionCharacter: String = {
            if currentGeneration % 2 == 0 {
                return "0"
            } else {
                if algorithm.first == "." {
                    return "0"
                } else {
                    return "1"
                }
            }
        }()
        
        for rowIndex in (-1 - margin)...(mapped.count + margin) {
            var characterArray = [Character]()
            
            for columnIndex in (-1 - margin)...(firstRow.count + margin) {
                let topLeft = mapped[safe: rowIndex - 1]?[safe: columnIndex - 1] ?? assumptionCharacter
                let topMiddle = mapped[safe: rowIndex - 1]?[safe: columnIndex] ?? assumptionCharacter
                let topRight = mapped[safe: rowIndex - 1]?[safe: columnIndex + 1] ?? assumptionCharacter
                let centreLeft = mapped[safe: rowIndex]?[safe: columnIndex - 1] ?? assumptionCharacter
                let centreMiddle = mapped[safe: rowIndex]?[safe: columnIndex] ?? assumptionCharacter
                let centreRight = mapped[safe: rowIndex]?[safe: columnIndex + 1] ?? assumptionCharacter
                let bottomLeft = mapped[safe: rowIndex + 1]?[safe: columnIndex - 1] ?? assumptionCharacter
                let bottomMiddle = mapped[safe: rowIndex + 1]?[safe: columnIndex] ?? assumptionCharacter
                let bottomRight = mapped[safe: rowIndex + 1]?[safe: columnIndex + 1] ?? assumptionCharacter
                
                let binaryNumber = "\(topLeft)\(topMiddle)\(topRight)\(centreLeft)\(centreMiddle)\(centreRight)\(bottomLeft)\(bottomMiddle)\(bottomRight)"
                
                guard let int = Int(binaryNumber, radix: 2) else { throw Error.couldNotCreateInt(from: binaryNumber) }
                
//                if int == 0 {
//                    print("New pixel is 0 from String")
//                }
                
                let newPixel = algorithm[String.Index(utf16Offset: int, in: algorithm)]
                
                characterArray += [newPixel]
            }
            
            arrayToReturn += [characterArray]
        }
        
        return arrayToReturn
    }

    func nextImage(from input: [[Character]], algorithm: String, margin: Int = 0, currentGeneration: Int = 0) throws -> [[Character]] {
        let mapped = input.map { $0.map { $0 == "." ? "0" : "1" } }
        
        guard let firstRow = mapped.first else { return [] }
        
        var arrayToReturn = [[Character]]()
        
        /// Will either be `0` if outside margins can be assumed to be `.` or `1` if outside margins can be assumed to be `#`
        let assumptionCharacter: String = {
            if currentGeneration % 2 == 0 {
                return "0"
            } else {
                if algorithm.first == "." {
                    return "0"
                } else {
                    return "1"
                }
            }
        }()
        
        for rowIndex in (-1 - margin)...(mapped.count + margin) {
            var characterArray = [Character]()
            
            for columnIndex in (-1 - margin)...(firstRow.count + margin) {
                let topLeft = mapped[safe: rowIndex - 1]?[safe: columnIndex - 1] ?? assumptionCharacter
                let topMiddle = mapped[safe: rowIndex - 1]?[safe: columnIndex] ?? assumptionCharacter
                let topRight = mapped[safe: rowIndex - 1]?[safe: columnIndex + 1] ?? assumptionCharacter
                let centreLeft = mapped[safe: rowIndex]?[safe: columnIndex - 1] ?? assumptionCharacter
                let centreMiddle = mapped[safe: rowIndex]?[safe: columnIndex] ?? assumptionCharacter
                let centreRight = mapped[safe: rowIndex]?[safe: columnIndex + 1] ?? assumptionCharacter
                let bottomLeft = mapped[safe: rowIndex + 1]?[safe: columnIndex - 1] ?? assumptionCharacter
                let bottomMiddle = mapped[safe: rowIndex + 1]?[safe: columnIndex] ?? assumptionCharacter
                let bottomRight = mapped[safe: rowIndex + 1]?[safe: columnIndex + 1] ?? assumptionCharacter
                
                let binaryNumber = "\(topLeft)\(topMiddle)\(topRight)\(centreLeft)\(centreMiddle)\(centreRight)\(bottomLeft)\(bottomMiddle)\(bottomRight)"
                
                guard let int = Int(binaryNumber, radix: 2) else { throw Error.couldNotCreateInt(from: binaryNumber) }
                
//                if int == 0 {
//                    print("New pixel is 0 from String")
//                }
                
                let newPixel = algorithm[String.Index(utf16Offset: int, in: algorithm)]
                
                characterArray += [newPixel]
            }
            
            arrayToReturn += [characterArray]
        }
        
        return arrayToReturn
    }

    func litPixels(in input: [[Character]]) -> Int {
        input.reduce(0) { partialResult, row in
            partialResult + row.filter { $0 == "#" }.count
        }
    }
    
    func reduced(image: [[Character]]) -> String {
        image.reduce("") { soFar, next in
            soFar + next.reduce("") { soFar, next in
                "\(soFar)\(next)"
            } + "\n"
        }
    }
    
    let redditAlgorithm = """
    #.#.#.#.#......#.#.#.#.##..#.##.##..#..##...#.#.#.#...##.##.##.###....#..#...#.#..###.#...#..##.#.###..#..####.###...#.#.#..##..##.##..##..###..#....#.#....#####.#...###...#.#....###...#..##.##..#..#.##..###..#.##.###..#.####...#.##.....#.###...#.##.##.#.#######...#.###..##..##..#.#.#.#####...#....#.....##.#.#...##.######....#..#......#.#.#.#.##...######.#.#####..#####..#.#.#.#.###.#.#....#..##..#..#.#.#..##....##..#.#.......##...#..####.####.#.#..#.###..#...#......###...#...#.##.#.####..#.#....###.####..#.
    """

    let redditInput = """
    .#.#.########.##.#...##.####...##..#####...##..#.#.###..#...#.#.##.#.....#..#.###...##..#.###.###.##
    .######.#..##.##...#.#.####.#.###..#..#.##.##...##.#...##..#.######...##....###...###..#.#.##.##....
    ..######.#.#.##.#.##.###.##..#####.####..#......#.##.###.#.#.##...#####.###..###...#..#..#..##.#....
    ###..##.#...##.#.#...######..#.#..##..##.#.##.#.#.#.##.#..####.#.#.##......#.#.#...#.##..#.###.###.#
    #.#.#...#..####...#.#..#.##.####.#..#..###########...#....#.#.##.###..#####.#.#.#.###...##..####.#..
    #.#..#.##.#..#..#..#....##.#.#.#...#..###.#.##.##.#.#.##.##..#.#.####.#######....###..#.######.#.#..
    ......###..#..##.####.##.##..#..#.##.##.#..#...###...####.#..#...###.##.#.#####.....#...#..#...####.
    ####..##.###.#...##..#.##....#..##.##..####.#.#.####.##..#..#.....#.###......#.#....#.#.....#.#..#..
    .###.####.#..###..#.#.#.#...##.####.#..#..##....#...###.#.#....#..#######.###.....#.#.#.##...##.#..#
    ##.#......#.##.###.#.##..##.##..#######.###..##..#.#####..#.#..#.#.#..#..##..##.##...#####.#.##.####
    .#.###....##.......#######..#.########..#..##..#.####.###..#..###.##..#...####.#.#..#.##.######.#..#
    ..###.#.##..##.#....#..#.####.....#.#..#..##.##.###..#.###.....##..#.##..#..#.#...#...#.#########.##
    ..#.#.#.#..#...#.##.#.##.#..#...##.#..........#.###.##.##....#####...#.#####.###.#......#..#.#.#..##
    #....#..#.#.#.####.#####.#.#.####.###......#.....#.#..######....##....#.##..##.##...#.#####.##..##.#
    #.#....#####....###.###.#.#...#.##.#..........#....##.#..##..##.####.##.#.##....##..#.#.##..##.#.###
    ..####...####..##.#.....#........#.#..##..#.#..###.....####...#...#.###....#....##.#..##.#.##....##.
    ...#.###........####...#...##..#..##.#.######...#...#.#.#...###....##..##.#..##.......###.##.###...#
    ##.#####...#.#.##.##.#...#.....#.##.########.....#.##..#.####.##...#......####..#.#..#..#...#.......
    .....###..##.###.#.#.#.....##.#.####...#..######.##....#.##.#.#.#...##.####.####.##....##.#.#.###..#
    .########..#.#.#.##..#..#..#.#..#..#.#.##.###.###.#...#.#..#####..##.###.#.##..###.###.#.#.####...##
    ###..##.##...#...#.....####.#.#......##.####..#......##..#####.#.....#.###.##.....#.##...#...#...###
    #.#.#.....##.##..#..#.###.#..##..##..#....#...##.....##..##.####.#######.....#........###..#.##.#.##
    .#....##..###.#..###.#...###.#...###...#.#..####..######......##.##.##..#...#..#####.####...##..#...
    ####.#..#.##....#.#.#...#.#.#####.###.#..##.#.###.....#..#.##......#.##...##..##...##..####.#...##..
    ....#.####..#..##.####.#######...#..#########.##.##..#..#.##.##.#.###.##.#.#....#####.###...#.####.#
    ..#.....##...###..#.##...#.#...###...#######.##..####.##.##..##.#########..###........##....#..#..#.
    .#.##.#.#.##.....##.#.##..###.###.#.....###...###..#.#.#####.##.#....##.#.##.##.##.#.#....#........#
    .#.#..#.#............#....###.#...####..####....#..#.##..#.##..#####...###.######...##..#####..###..
    ###.#..##.#...##..#.#..#..##.#..#..#..#..#####......##.##..#####..#......#..#####.##.####......##.##
    ##...#...##.#####..#...#.#.....#.#..###.#..#.####.....#.....#.#.#.#.###.####..#.......##.#....#..##.
    #...#.#..#####..###.........#.####.###..#....###...#......#...#.#..#.....#####..#.###...#.#...#.....
    ###....#..##.##.####.###.#.#.##.#.#....##..#....##..#.#.###..######.#.#.#..####.##...####..##..##.##
    .###...##.#.#####.#...#.###..##..###....#.##....#...#.#..#...##.###...#.#.#.#######......###.###.#.#
    .#.#.#.....#..##..#.##.#..#.....#.#.######..#.##.#....###.#....#...#####..#.######.###....###...####
    ####..#....########...#..##..#####.#...#.##..##..###...###.#####....##.#.#..#.###.#.#..#.#.#..#.###.
    .##.##.##.#####...#..#..#.###.#.#..###.#......###.##.#.###..#####.#.#...#.###.#.#.###.##.#...#.##.#.
    #.#.##....#####...##.#.##.######.#.#.##.###.#.......###......##..###.#.###...##..##.#.#...#..##.####
    ##.#....#.##.#..#...#.#...#.##......####.#.#..#..###.#####.#...##.####...#..###.##.#.##..###.####.#.
    #.#..#.#.##...##.....###.#.#.#..##.###.#######........###..#.....####.#.##.##...####.##.#.##.###.###
    ##...#.####..#...#...##.#.##..#.##.###..#.##..##......#..#.#...######..#....#.######..######..####..
    .....#.#.......####.....#..#.####.#...##..##...#....#.########.#.#.##..##.##..####..##.####..#.#.###
    .#..#.#....#..##..#....##...###........#.#..#.##.####....###..#..##...#..##.#.#.###.#.#.#..#.####...
    #.#...###.#....#...##############...###..##...#.#.##..#..#....#...####....##..###.##..##..##.#..##.#
    ##..#....#...#..#..##.#..###....#.#.#.###.#.#.###..###..####.###.#.#.###.#..###.#.###.#.##...#.#####
    #..#..####.....###..#.#...##.######..####..#..#....#####...#...#..#..#.....#.##.####......#..##.###.
    ##.##..###.###.#..###...#.####...#....#........#..#..##..##..##.#.##....#.......#.###...#..###.#....
    #.##.#.#..#..###..###...#...#.###..####.#.#....#.#.......##...#..#......##....##.#####.......#...#..
    ....#..#..##.##.#.##.#.##..#.##..##.##.##.##..##.######.##..##.....#.###..#...#.##.#.#.####.###.###.
    .###....##.##..##..#.###..##.#..#.#.##..##.###..##.###..#......########.#####....##...#...##...##.##
    .###.###.#.#######.......#.#.#.##.##..#.#.#.##..#.##...##.##.#...##.#.#######.#..#..##..#.#..##.##.#
    ....#.###.#.##...##..#...#...#..##...#.##...##.##.##.#.#####.....#.#.#.##..####.####.#..####..#..##.
    ##..#.##.#######.#.#...###.#....###.###..##.###.##.##.#.#..##.....#.##......##.###..##.#.#.##..##...
    ...#####.#.##.#..##....##.###.##.#..##..###......#.#..####.##...##.#.###...##.....#..#..###..#####..
    .#####.#.#..#....####.#####.#..##..#.#####.##..#.#.#..##...#.#..######.###..##....###.#....###...#.#
    ..###......##.##.#.##..#..##.....##....##.##..##.....###.#..##.#.#######..#...####..#.###.#####.###.
    ##..#.######.####..#.#..###.#..#.#..#######.#...#...##.#.###.#.##..##.#......##.#.#..##.#.#.#.####..
    ..#.#.####.##..##.#.#.#..####.#.##...###..#.##..#.##.###..####......#..#..#####.#..#.#####.#.###.###
    #..#.#.....#.#...#..###.####..##..#....##.#.###..##..#.#..#.####...##..##..#..####...#########....##
    .#.....#......##.#..#.####.######..#.#.#.#.##...#..#..#...#.###..#....#..#.#...#####..###.##...#.##.
    .####....#.###..#..###.#...#..###.#.#..#......###.##.#.#.#.#####..#######..####.##.....#....#..##.#.
    ...#.##.#.#..####.#####..##..#.##.###.#####..###...##...##.##..#.####..##.#...####...#..##......###.
    ###...##.....#.###...##.#..#.#......##..#...##.#..##.#.#..#.###..#..#####..#.###..#.#...#..##.#.#.#.
    ##.##.##.#.#.#.####.##..##....#.####.####.####...##.####.#....###....###.###.#..#.####.#...####.#.#.
    ####.###...####.#.##...#...##..##...##....#.#.####..#..#.....#.....##....###.....###...#...##.#.###.
    ######..#..#####...#..#..######.##...#.###.#....####..####.##.#.#..#.#.####.##.####..##...####.##.#.
    ##....#.#...#..###..#.##.#.#...###..####.....#.##.#.####..#.##....##...##########..##...###.#.###.##
    ..#.#######....#####..##.####.##.#####..###.#.#..####.....###########...##.#....#.#..##.##.###..###.
    ##.....##...#..#....#####...#...#..#.#.#.#.####....##...####.#.#.#.....#.#..........#.###..##.#.#.#.
    .#####...#..#.##..##.#...#.#.##..###..#.#....#...#.#.#..#.#..#..#.###.#...######.#.####..##..##.#...
    ..#.#.#.##..#.##..#.###......###..#....##.###.#..###.#...##.#.#.....#.##....##.##.##.#...####.####.#
    ##..#.##.##.##.#....##.#..#..#.##.###..##.##.#.#.#......####..##.#.#.###.....##.....#.##..####..##.#
    .###.#.##.#..##.##.#.###.#.##.##.#####...#.#..#..#..#..#.####..#.######..#.#.#...#..#####...#.#..##.
    ..#...#.####.####.####...#..#..##..#.##.#.#..#..####..#...#.####.#.###.##..#......#..#...#..#..###..
    .#..#.###.......#..##.#.#..##..#.#..#..##..#.....####.###...#..#.###.##.#..#.#..##..#...##.##.##....
    #....##..#...##.###.#......##..###...##.###..##..###.####.....#...###..#.#...#####.#.#.######..#..#.
    ##.###.....#...#.#..##.#.#..#.#....#...#..##.######.###.#.####.#.######...#.#.#....##.##..#...#...#.
    .......#..#.##..#..##...#.##.#####..###.####.###.#.#..###....#.#........#..#.#.#.......####..#......
    #####...##.######....#.#.##.#..##...#..#..#..#...#..##.###....#.#.......##...#.###.###..####.##.###.
    .###.##.#....#.#..#..#..##....##...##.#...##....#......#####...####.######.#.#.##.##..##.#.#.....#..
    ..#.##..#.####..####.##.#...#..####..##.....###.#...###..#.###.######.#.#.##..#.#.#####.#.##.#.##...
    .##.###########.#..####.#.####..#.####.##########..#.##.#.#.#..#.#..#.#####.....##.#...#.###..#.##..
    ...###.#.#..#.#.#.#....#..##..####.##...###.#....#.#.####.#.#..#..####...####..###.##..######.##....
    #..#####.#######.#.###......#..#.#.##.##.###.#.##.#...#....#.#####..###..##.#.#####.#..#..#.###.#..#
    #.####..#..#.......###..#..####.#.#.#..#.#..#..#.#...#####.#.......####.#.#.##.##.#..#..##.#....##.#
    ###.###...#..#..##.#..#.#..#..#####.#.#####.....#..#..####....##.##.....#.....#.###.#.#.#.##.#.####.
    .#.##.#.#..#.#####.#.##.#.###.#...#..#..#.#...##.#.##......#.#.#####..#......###.########.#..#.###.#
    #.##.....#.####..######..##..#...#.....##..##..#.#.##.###.#.#.#.#.....#...#.#..###..##..##.######.##
    ####......#.##..#.##..##.##..#.##.....#####...#.#...###.#..##..###.##.###..............##.#.#....#.#
    ###...##.##.##.####....####..#...##...#.####.#....#.....#####.....##...##..###.#...##.#...##.##.##..
    #.#.####...###.....###.###.##.###.....##.##.....###..###..##......##..####.#..##.#.##....##.#.#..#.#
    ####...###.#####.#####.......##..##.###..#..##.##..#..###.#..#..###.....##..##..##.##.#..####.#.#.#.
    ######....#.##.##.#.###...##...###.###.#.##.###....##.#......#.##.##.#####...#..##....###...#..##...
    ..#...........##..........#.##.#.##.##.###...##..##.#####.#####.#...##..####.....#.##....#..#.###.##
    .#..##.#...#.#####...##.#.#.###.#.#..##..#..##########..#.#...#...#...##.##.#...##..#.#.#.##.#..#..#
    ..##....##.#..#...#.#...#.#....#..#.#.#####.##.#......#...##..######..##....####..##.##.##.###.###..
    #.......#..############...##....##...#.#....#...##..###..##....####..##....#...##.###...#..#...#####
    ..##..##..#.###.#.##.#.####.#.##...#.#..#.#####...######...######.####...###.#.#.##..#.######..#.#..
    ###.#....#####..#.##.##..###..##.#..#.#.#.##.#......#..#....##.#.#.###..#.#######.###..#..#..#.###..
    #...#.#..#.####.###..##.#.#####...#.#.##..#..#.#####.#.###.##.####..#..##.#.##...##...####.#..#.###.
    ...#.##.##...#.#...####....#..#####...#.#.....####.##.######.#.#...#...###.##..##.#.#.#..#...###.#..
    """

//    do {
//        // should be 5326
//        let margin0 = try nextImage(from: redditInput, algorithm: redditAlgorithm) // 5137
//        let margin0Gen2 = try nextImage(from: margin0, algorithm: redditAlgorithm, currentGeneration: 1)
//        print(litPixels(in: margin0Gen2)) // 5326
//    } catch {
//        print(error)
//    }
    
    let puzzleAlgorithm = """
    #####.##....##....##.#.....##....##..########.#.##.#.#.##.#..##.#.####.######.#####.######.##..#######.#.#...#..#.####..####...#.####..#......#...#...##.#.....#....#..###.#..##....#.#....#...##.###.#.#..##.......####.........#.#.###.#.#.....#..##..##.#.##..###.##.###.#....#.#..##.#.......###..#.#.#.#.#.....#..#.###.##..##...#....##...##.##...##.#..####.#...#.####...####..#####.#####.#.##...#.###.#######.###..#..##.#.#..#.#.#######.#####.#.##.#.#...##.######.#...##.##.#.........##...##.....#.###.#.##.#.####.
    """

    let puzzleInput = """
    ..###.#.#...##.#....#..##....##.#.#......#.##.##...###..#.##...#..#......#..#....###.###..##.#..#.##
    .#...#..#.##.##....###.##.######.#.##..#..#..#.##.#.###.#..#..##...#..##...######.#..####.#.#.#..##.
    .##.#.##.#.....###.#.#...#####.#.#.#....#....##...#.....##.#...##....##.#.#.#..##.##...#..#..#..#..#
    #.###.###.#.#.#....##.#.....#.#.#.#...#.#.#####....#.#.##.###..##..#..#.#...#.....#....#.###.#..#...
    #.#.##..#..###..##...####.#....#.#.#.###.##..#....##.#..##.#...####.....#.#..##.##....######..##.#..
    .#..#..##..#.#.##.####..#..#..##.#.#..##.##.###....#.#.####..#.#.####..##.###...#..#.#....#..#..###.
    ..##.#####..#...##.#...#####...#.##....##.###...#.#.#.##.#.####.##..#.#.#..###...#..####......###.##
    ....#......###.#...###..#####.#.##.#.#####..####..##...#..#.####.#.##########.######...####.###.####
    ###.####.#.###.#..#.##.#.#.#.####.##...##.....#..#.###..####..#.#.#..#######..###.....#..##...#....#
    .###.#.#######.#..###.##..#.#..#..######......##.#.##..#....##...#....###.######.#.#.#.......##.....
    #...#.####....#...#.####.##..#.#####.#..####.###.#...##....##..##.#.##..#.###.##..###..##..#.#...##.
    ..#..##.##.#..#.###.......#..###...##.###..#.##.#...##...#..####.##.######..#.#.#.#..#####.#########
    ####.##..###..###.##.#.####.##.....#.###..#..##.#...###..#.##...#...###.######.##..#..#####..#.#.###
    ######.##...##.......#.##...#.####.#.##.#.#..##.#.#.##.#...##..#.##.##.##.####.####..##...#...##.#.#
    #.##...##...#..#.##.#.##.#####....#.##.###..#####.##.###.###..##.....#####..#...#..#.#.##.##.#.##.#.
    .##.#...#.#..###.#.##.#..#.....########...#..##..##..##..###.....##...#.#.##.###.#.#####..##..##..#.
    #.#.#......####...#...###..##.##.#.##.#....#.#.######...##.#...#.##.##..#...####...#...##.#.####.##.
    #..###..#.....#..###...#.#.##.######....#.#...##..######.#.###.###.......###...#.....#####.....#.###
    #.#.##...##.###..#.###.#.##..##.##..#.#.########........#####.#.###.#.##.#.###.#..####..#.#..##..###
    #...##...###.#.#.##.....#.##.###.#..##..#.###..#.#.##.#.##..#..#.#...#.#.#####..######.#.#.##..#.#..
    #####.#....#.#..###.#....#.##..#.###.#.......###..######..#.##.###..######.#.##.#..######.##..##.#..
    ##...##...###.#.###.#.####...###.######...#...#########.#.....#...##.#.....#..###..#..##..#.#####...
    #.###..#.#.#.##.....#...#.#..#...##...####..##..##.##............#...#...#..#.###..#....#.#.#.#.....
    .##..###.#...##...#...#####.##....#.#...#.##.#.##..##..#.##..#...##........#.....#...##...#..#.#.#.#
    .#.#.#.##..#...###.####.##.......##.###..#.##.#####...#.#.#####.####..####.#####...######..#.##.....
    .##...#.##..#..#...#......###....#.#..##.##..#...##.#.#..#####.#.######.####...###......#.....##...#
    ...#.#....#.#.#...###..##..#.####.#..##...##.#.##.....#...#.#.#....#.#.##.#..#....#.####...#.....###
    ##....#.####........##...#..###.#.##..##..#.....####.#.###.##.#.##....###.##.#..##.###.##..##..##..#
    #..##.....#....###.##....#.#.....####.###..####...#.#####..#.#..##..#.##.#........#.#.#.##.###.#.##.
    #..######.####..##...#.#...#########...#..#...###..##.###.....#.#..##.#....#..#.#.#.........#..#.#.#
    ##.....#..###.##..##..#.#..###.#.#.##.###....#.##....#.###...#.#.##.#..#.#.###.###.##....###...#.##.
    ....#####.#......#..###...##.#........##..#.#####..#.#####...#.##..##.#..#..#.#.#....#..#..#...###.#
    .###.##.##......#.###.#.#.##..##.#..#.#.#..#..#...##.##..#.########.##..##.#.#..#...####.###.##.##.#
    .#.####....#..##.#.....###.##.##..#.##...#.....#..#.......#.#..#..###.#..###..##.###..##..#.##...#..
    #.....####.###..##.#....#####......##.#..##..##.#####....###......##.#...##.#.#...#####..#####.####.
    ..###..#..##...##.#.####...#########.###.#.#.##...#..#..##..###.##.#..###.#.#..##.....#.#..#.###.#..
    ###...#.#....##.#..#....###......#######..##.####.#.##.#.#.#..#....##.##....#..#####.##.#....####..#
    ...##.###....#..#....#.#.#...##.#.#.###.....##..#####...#.###.##....##..###.##.##.###..#.##..##.##..
    #.######....#.###..##..#.##..###.##...##.#.###.#.#....#.#######..#...#..#.#..#...#.#..##...##.#...##
    .##.#...##.###.#..##..#....###.#..###..#....#..##..#.#....#.####.#.#.#.#########.#..###.#..#....####
    ...#.##..#####..#..##..#.##.####...###..###.#.#.#.#.##.###.######.#.#..#...###.##.#...##.#.#.#.###.#
    #..####...#####...#.##..##..##.#####..#.#.##.#...#..#.###.##...#.#.####.##.######..#.##....########.
    #.#.###..##.#.#..#.#..#.#########.#.#...#..##.#.#..##..#.#.###.#..#.#####.##.#.##.#.##......###.##.#
    .#.###..##.##...####.##..##..####.....#..#.....#..#...##.##.#...#..#..#....#####....#.#..#.##.##.##.
    .#.#.##...##..#.####.##..#.....##.##....###.##.....#..#.######...##..#.#...#####...#..#...#.#.###.##
    .##.##.#.##.....######.#.#.....##..##.....#...#.#.#..###.#.#.#....#.#...#..##.##.#...##.#..##..###.#
    .#.##...#.####.##..#..#.#....##.......#.#.###.##.#.####.##.#.##.#...#.#.#.#######.##....#..#.#.##..#
    ......###.#.#.##.#####..####...#...#.##....###.#####..##.##.......###..#.##..#..#..#.#..##.#...###..
    .#..#.##..#.#.##..#..#######.........##...###...#.##..##..#.###.#...#...#.##.#..#####...#..#.#######
    .#.#.#.#....##...###..###.##########.#..#.##...##.##.....#.#.....#..##.##...##.....####.##..####.#..
    .#.##....#.#....#..#.###..#.....#...#.#.#...#.#..#.#.##.##...#...###..#....#.#.#####.####.#.####.##.
    ..#.#.#..#########.##.#....#.###.##.###.#.#..###.#..####.#..#.#...###...##...##..#.##.#..######..#..
    #.#.#.#####.######.#.##....###.#.###.###.....#.#.##.#..###..##...##.####...##.#..####.#.#.....#...##
    #.##.#.#..###....#.##..######......#####.##.##......##.#.###.#...##......##.###.#.##...#.#.#.......#
    #####.##....#..#####.#.###...#.###.#.##..##....#.###...#...##.###..#####...#.###.#.#.##....#.#.#..##
    #.##.##....#..#.#...##.....###.#..###.#.###...#..#..##..##.#.#.###....#######.#.#...#...#.#.#..#.#.#
    ##.#####...#.#.........##.###..#.#..###..#.##...#...#.##..#.##......#...#.#..#..#..#..#.....##.....#
    .#.##..###.#..#..###...#.##.##..##.....###.#.#.#####.##.#.###................#..#.##..##....#.#.###.
    .....##.....####...#.####......#....#.####.#####.###.#..###.....#....####.####..#.##..###.##..#.....
    .#..###.#..####...#..#..##.###....#.#.#..#...#.###.#...#..#..#.#..#.#...#...#.###...#.##...###.####.
    #.###....#..#...#..#.#...##.#..##....#.#######.#...###.##.#.#...#.....##.##....####.#..####.##.##.#.
    .##.#.###.#..#.###..#.##..#.....##..##....##...#########.#.###....###....##....##...#..#......#...#.
    ######.##.###.####..####...##........###.#.#...###.##..#.#....#.......##..##..#.....#.##......#...#.
    ....##..#.##...##....##.#...##.##..#####..######.#...###.####.#####..##...#.#.##.#........#.##.##.##
    #####..#.#..#########...#####..#..#...###..##.###..##..#....#...####.#.##.#..#.##.....#..#...###...#
    .#.....##....##.....##..####...#..#........#.....##.###.##.#....#.#.###..#..#.#...##.##.#.###.##.#..
    #####...###.###.#.#######...##.#....#....#....#...##..##...#...#.#..###.#...#.##.....#.#..##.#.##.#.
    #####....#..###..#.#....###.####.....######....######.##....#.###..###.####..#...###.#..#.########..
    ###......#.#...#.#.##.#.#.#..###..#.####...#.###..#.###.##.#...#..#..##..##.######..#..#.##.#.#####.
    ...#...#####...#.########.#.#####.......###...###.#.##.##.#...######..#.#..##.#....#..#..#.##...#..#
    ####........#..##..#......##...#.#.##..#.##.#.####...#.####.##.##.#.#..##..#....#...##......#..##.#.
    .######...#.###..####....#.#....##.......#.#.....####.....##.#####.##.#..#.#.###..#.#.#.#..#..###.##
    #..#.#.#.#..#.##....#.##.#.###....##.#..###.#...#.###...#..####.##.....#.#####.####...#.##.#.#####.#
    ..#####..#...#..#.#.##.#...###...#.......#....#..#..##..###.#####..#.#..#...###.#.#.##.....##...##..
    ##.#.#...##...###......#..#..##..###..##......#..#.##.##..##...#..#.#.#.#####.#..#..##.##.##..##.#..
    #.##...#...#...###..#.##..##....#....###..#...#.###.#..##...###.##.#.#..##..####.####..##.##.##.##.#
    #...#######.###.##....#..###.#.#......#.####..#..##..#.#.###...#....###.....#.#....#.#.##.....#.##.#
    ..#.##...#.#....##....#..#####..##.#.#########...#.##.##.###..##...##..#...###..###...#...##....#.#.
    #.#.###.##....#.#.###.....#..#.##.#...##.####...###.......#.####.#.#..##...###.....##.#.####..##.##.
    .#####.###.#.##..#...#....#..##..##.##.##.####...#......##.#.#..#.....#.#..##...####.##..#.##.##....
    ....##.#..#....#....##..#.##...#..#...###..#..########.#..#..#..####..#.###.#####..###.##.#...#..###
    .####...###.#...#.#.#.#.#..#.###.#.#.#..#.##..#....#####..#..#..#.......#..#..####.##.#.#..##.####.#
    .#.#.###...#..###.#..##.##..#..#..#..###..#.####..###..#.#.....#.#.#.#.##...#..##..##..#........#.#.
    #.##.#.....#.......##.##...#.##...##.#.#.#..#.#####.#.##.##.#...####.#..#....#.##.###....#.....##.#.
    ##..##.#..#..#.##..##.##.###.#....#..#...#.##.#...##.####.#.#..##...##.#...#..#..###...##..#.#......
    .......#...#.####..#...###.#.##.##..##.#.##..##.##.###..#...##..#.###.##....#.#.#..#.#######.......#
    ....#####.###.#.#..#.##.####..#...####...###..#..####......###..####.###..#...#.#.##....##......##..
    #.##.#.#.##..#.#....##.###...#..##..#.#..####.....####.#######.#..#..######.#.#...#.####......#.##.#
    .#.#.###..#.##..#.#.###.###..#..#...#.#.#.##..##..#..#..#..#........##..#.##..#.#....#..#....##..#..
    .#...##..#..#..###.#####.#.##.##..#.#.#####........##..#..#....###....####..#.##..####.#.#######.#..
    #..#.####.###....###....####.....#.#.###..##..#.######.#.....#..#.##.#..#.#.######....#...#####....#
    #...#.#.#.....###..#.#..#.######....#.##..#.#.#.##.##.##.......#...##..###.#.##..###.###.##..#####.#
    #..###.###.#..##...#.####.#.########.###.#####.##.##.####..#..######...##..#.....#.##..#..#....#...#
    ###..###.##.#...###.#..##....##.#..#.##..#........##..##.#..#.#..#.#...##..#...#.###.#.#.#..#.##....
    ..#.##.....#.#####.#.#..#......##.##.##.#.##.####.#..#..#.##..##.###.#.###.##...#....#..##.###..#.#.
    .##..#..#..#..##.##.#..##.#..##.#...##...#.##........##........#.#..###.###..###.##.#...##.####.#.##
    .#.########....#.....#....##...#...#.##.#....##.#.#....##.#..#.###.#####......#...####.####..###.##.
    ...#..#.##.##.......#.......###.##.##..###.#.#....##.##.#.#....#.##.....#....##.....#.#...#...##..#.
    ####..#.......#..##...#..#...########.##...####..###.###..##.#.###.#..##.###.#..##.#.#...#..##..#.#.
    ...##...#.###.#.....#..#.###..#...###.###.#.######.####.#...##.##.###.##.....#.##..##.#.####..###.#.
    """

    do {
        let puzzleGen1 = try nextImage(from: puzzleInput, algorithm: puzzleAlgorithm)
        let puzzleGen2 = try nextImage(from: puzzleGen1, algorithm: puzzleAlgorithm, currentGeneration: 1)
        print(litPixels(in: puzzleGen2)) // 5419 (correct)
    } catch {
        print(error)
    }
}
